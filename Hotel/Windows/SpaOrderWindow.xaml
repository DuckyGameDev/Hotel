<Window x:Class="Hotel.Windows.SpaOrderWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Hotel.Windows"
        mc:Ignorable="d"
        Title="Заказ SPA-процедур" 
        Height="600" Width="900"
        WindowStartupLocation="CenterScreen">
    <Grid Background="#FFF0F5FF">
        <DockPanel>
            <!-- Шапка с кнопкой возврата -->
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Top" 
                       Background="#FF4A6FAE" Height="50">
                <Button Content="Назад" 
                        Width="100" 
                        Background="Transparent" 
                        Foreground="White"
                        BorderThickness="0"
                        FontWeight="Bold"
                        Margin="10 0 0 0"
                        Click="BackButton_Click"/>
                <TextBlock Text="Заказ SPA-процедур" 
                          Foreground="White"
                          VerticalAlignment="Center"
                          FontSize="16"
                          FontWeight="Bold"
                          Margin="20 0 0 0"/>
            </StackPanel>

            <!-- Основное содержимое -->
            <ScrollViewer DockPanel.Dock="Top" VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="20">
                    <!-- Список услуг в DataGrid -->
                    <GroupBox Header="SPA-процедуры">
                        <StackPanel>
                            <DataGrid x:Name="ServicesDataGrid" 
                                     AutoGenerateColumns="False"
                                     CanUserAddRows="False"
                                     CanUserDeleteRows="False"
                                     IsReadOnly="True"
                                     SelectionMode="Single"
                                     Margin="0 10 0 0">
                                <DataGrid.Columns>
                                    <DataGridTemplateColumn Width="Auto">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                         VerticalAlignment="Center"
                                                         HorizontalAlignment="Center"
                                                         Click="CheckBox_Click"/>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTextColumn Header="Услуга" 
                                                       Binding="{Binding Service.ServiceName}" 
                                                       Width="*"/>
                                    <DataGridTextColumn Header="Цена" 
                                                       Binding="{Binding Service.Price, StringFormat='{}{0} рублей'}" 
                                                       Width="100"/>
                                    <DataGridTextColumn Header="Длительность" 
                                                       Binding="{Binding Service.Duration, StringFormat='{}{0} мин'}" 
                                                       Width="100"/>
                                    <DataGridTemplateColumn Header="Дата" Width="150">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <DatePicker SelectedDate="{Binding ServiceDate, UpdateSourceTrigger=PropertyChanged}"
                                                            IsEnabled="{Binding IsSelected}"
                                                            Width="120"
                                                            SelectedDateChanged="DatePicker_Changed"/>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTemplateColumn Header="Время" Width="150">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <ComboBox SelectedValue="{Binding ServiceTime, UpdateSourceTrigger=PropertyChanged}"
                                                          IsEnabled="{Binding IsSelected}"
                                                          ItemsSource="{Binding AvailableTimes}"
                                                          DisplayMemberPath="Value"
                                                          SelectedValuePath="Key"
                                                          Width="100"/>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                        </StackPanel>
                    </GroupBox>

                    <!-- Итоговая сумма -->
                    <Border Background="White" 
                            BorderBrush="#DDD" 
                            BorderThickness="1"
                            Padding="10"
                            CornerRadius="5"
                            Margin="0 20 0 0">
                        <StackPanel Orientation="Horizontal" 
                                   HorizontalAlignment="Right">
                            <TextBlock Text="Итого к оплате: " 
                                      FontWeight="Bold"/>
                            <TextBlock Name="TotalPriceTextBlock" 
                                      Text="0 руб" 
                                      FontWeight="Bold"
                                      Foreground="#FF4A6FAE"
                                      Margin="5 0 0 0"/>
                        </StackPanel>
                    </Border>

                    <!-- Кнопка заказа -->
                    <Button Content="Заказать выбранные процедуры" 
                           Width="220" 
                           Margin="0 20 0 0" 
                           HorizontalAlignment="Right"
                           Click="OrderButton_Click"
                           Background="#FF4A6FAE"
                           Foreground="White"
                           FontWeight="Bold"/>
                </StackPanel>
            </ScrollViewer>
        </DockPanel>
    </Grid>
</Window>